# æ•°å­¦æ¼«ç”»ç”Ÿæˆå™¨ - å¼€å‘è€…æ–‡æ¡£

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ (Blazor Server)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MathInputComp   â”‚ â”‚ ComicDisplayCompâ”‚ â”‚ HistoryComp     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIå±‚ (ASP.NET Core)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ComicController â”‚ â”‚ ä¸­é—´ä»¶ç®¡é“       â”‚ â”‚ é”™è¯¯å¤„ç†        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ (Shared)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ComicGenService â”‚ â”‚ ValidationSvc   â”‚ â”‚ StorageService  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¤–éƒ¨é›†æˆå±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Gemini API      â”‚ â”‚ æ–‡ä»¶ç³»ç»Ÿ        â”‚ â”‚ æ—¥å¿—ç³»ç»Ÿ        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: .NET 8
- **å‰ç«¯**: Blazor Server
- **API**: ASP.NET Core Web API
- **æµ‹è¯•**: xUnit + FsCheck
- **AIæœåŠ¡**: Gemini Nano Banana Pro API
- **å­˜å‚¨**: æ–‡ä»¶ç³»ç»Ÿ + JSON
- **æ—¥å¿—**: Microsoft.Extensions.Logging

## ğŸ“ é¡¹ç›®ç»“æ„

```
MathComicGenerator/
â”œâ”€â”€ MathComicGenerator.Api/          # Web APIé¡¹ç›®
â”‚   â”œâ”€â”€ Controllers/                 # APIæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ Middleware/                  # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ Services/                    # APIç‰¹å®šæœåŠ¡
â”‚   â””â”€â”€ Program.cs                   # å¯åŠ¨é…ç½®
â”œâ”€â”€ MathComicGenerator.Web/          # Blazorå‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ Components/                  # Blazorç»„ä»¶
â”‚   â”œâ”€â”€ Pages/                       # é¡µé¢
â”‚   â””â”€â”€ Program.cs                   # å‰ç«¯å¯åŠ¨
â”œâ”€â”€ MathComicGenerator.Shared/       # å…±äº«ç±»åº“
â”‚   â”œâ”€â”€ Models/                      # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ Interfaces/                  # æ¥å£å®šä¹‰
â”‚   â””â”€â”€ Services/                    # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ MathComicGenerator.Tests/        # æµ‹è¯•é¡¹ç›®
â”‚   â”œâ”€â”€ Services/                    # æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ Models/                      # æ¨¡å‹æµ‹è¯•
â”‚   â””â”€â”€ PropertyTests/               # å±æ€§æµ‹è¯•
â””â”€â”€ README.md                        # é¡¹ç›®è¯´æ˜
```

## ğŸ”§ å¼€å‘ç¯å¢ƒè®¾ç½®

### å‰ç½®è¦æ±‚
- **.NET 8 SDK** (8.0.100 æˆ–æ›´é«˜)
- **Visual Studio 2022** æˆ– **VS Code**
- **Git** ç‰ˆæœ¬æ§åˆ¶
- **Gemini APIå¯†é’¥**

### ç¯å¢ƒé…ç½®

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd MathComicGenerator
```

#### 2. å®‰è£…ä¾èµ–
```bash
dotnet restore
```

#### 3. é…ç½®APIå¯†é’¥
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp MathComicGenerator.Api/appsettings.json.template MathComicGenerator.Api/appsettings.json

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ Gemini APIå¯†é’¥
nano MathComicGenerator.Api/appsettings.json
```

#### 4. æ„å»ºé¡¹ç›®
```bash
dotnet build
```

#### 5. è¿è¡Œæµ‹è¯•
```bash
dotnet test
```

### å¼€å‘å·¥å…·é…ç½®

#### VS Code æ‰©å±•
```json
{
  "recommendations": [
    "ms-dotnettools.csharp",
    "ms-dotnettools.blazorwasm-companion",
    "ms-vscode.vscode-json",
    "bradlc.vscode-tailwindcss"
  ]
}
```

#### è°ƒè¯•é…ç½® (launch.json)
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch API",
      "type": "coreclr",
      "request": "launch",
      "program": "${workspaceFolder}/MathComicGenerator.Api/bin/Debug/net8.0/MathComicGenerator.Api.dll",
      "args": [],
      "cwd": "${workspaceFolder}/MathComicGenerator.Api",
      "env": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    {
      "name": "Launch Web",
      "type": "coreclr",
      "request": "launch",
      "program": "${workspaceFolder}/MathComicGenerator.Web/bin/Debug/net8.0/MathComicGenerator.Web.dll",
      "args": [],
      "cwd": "${workspaceFolder}/MathComicGenerator.Web",
      "env": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  ]
}
```

## ğŸƒâ€â™‚ï¸ è¿è¡Œå’Œè°ƒè¯•

### å¼€å‘æ¨¡å¼

#### æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# Windows
start-dev.bat

# Linux/Mac  
chmod +x start-dev.sh
./start-dev.sh
```

#### æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨
```bash
# å¯åŠ¨API (ç»ˆç«¯1)
cd MathComicGenerator.Api
dotnet watch run

# å¯åŠ¨Web (ç»ˆç«¯2)
cd MathComicGenerator.Web
dotnet watch run
```

**é‡è¦**: å¿…é¡»åŒæ—¶å¯åŠ¨APIå’ŒWebé¡¹ç›®ï¼ŒWebé¡¹ç›®ä¾èµ–APIæä¾›æ•°æ®æœåŠ¡ã€‚

### ç”Ÿäº§æ¨¡å¼
```bash
# å‘å¸ƒAPI
dotnet publish MathComicGenerator.Api -c Release -o ./publish/api

# å‘å¸ƒWeb
dotnet publish MathComicGenerator.Web -c Release -o ./publish/web

# è¿è¡Œå‘å¸ƒç‰ˆæœ¬
cd publish/api && dotnet MathComicGenerator.Api.dll
cd publish/web && dotnet MathComicGenerator.Web.dll
```

### Dockeréƒ¨ç½²
```dockerfile
# Dockerfile.api
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY ["MathComicGenerator.Api/MathComicGenerator.Api.csproj", "MathComicGenerator.Api/"]
COPY ["MathComicGenerator.Shared/MathComicGenerator.Shared.csproj", "MathComicGenerator.Shared/"]
RUN dotnet restore "MathComicGenerator.Api/MathComicGenerator.Api.csproj"
COPY . .
WORKDIR "/src/MathComicGenerator.Api"
RUN dotnet build "MathComicGenerator.Api.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "MathComicGenerator.Api.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "MathComicGenerator.Api.dll"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - "7001:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
    volumes:
      - ./data:/app/data
  
  web:
    build:
      context: .
      dockerfile: Dockerfile.web
    ports:
      - "5001:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
    depends_on:
      - api
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•ç±»å‹

#### 1. å•å…ƒæµ‹è¯•
```csharp
[Fact]
public void MathConceptValidator_ValidInput_ReturnsTrue()
{
    // Arrange
    var validator = new MathConceptValidator();
    var concept = "åŠ æ³•è¿ç®—";

    // Act
    var result = validator.IsValidMathConcept(concept);

    // Assert
    Assert.True(result.IsValid);
}
```

#### 2. å±æ€§æµ‹è¯•
```csharp
[Property]
public Property ValidMathConcepts_ShouldAlwaysBeAccepted()
{
    return Prop.ForAll(
        GenerateValidMathConcepts(),
        concept =>
        {
            var validator = new MathConceptValidator();
            var result = validator.IsValidMathConcept(concept);
            return result.IsValid;
        });
}
```

#### 3. é›†æˆæµ‹è¯•
```csharp
[Fact]
public async Task GenerateComic_ValidRequest_ReturnsComic()
{
    // Arrange
    var client = _factory.CreateClient();
    var request = new ComicGenerationRequest
    {
        MathConcept = "åˆ†æ•°åŠ æ³•",
        Options = new GenerationOptions()
    };

    // Act
    var response = await client.PostAsJsonAsync("/api/comic/generate", request);

    // Assert
    response.EnsureSuccessStatusCode();
    var comic = await response.Content.ReadFromJsonAsync<MultiPanelComic>();
    Assert.NotNull(comic);
}
```

### æµ‹è¯•è¿è¡Œ
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
dotnet test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
dotnet test --filter "ClassName=MathConceptValidatorTests"

# è¿è¡Œå±æ€§æµ‹è¯•
dotnet test --filter "Category=PropertyTest"

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
dotnet test --collect:"XPlat Code Coverage"
```

## ğŸ”Œ APIæ–‡æ¡£

### æ ¸å¿ƒç«¯ç‚¹

#### ç”Ÿæˆæ¼«ç”»
```http
POST /api/comic/generate
Content-Type: application/json

{
  "mathConcept": "string",
  "options": {
    "panelCount": 4,
    "ageGroup": "Elementary",
    "visualStyle": "Cartoon",
    "language": "Chinese"
  }
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": "comic-123",
    "title": "åˆ†æ•°åŠ æ³•çš„æ•…äº‹",
    "panels": [
      {
        "id": "panel-1",
        "imageUrl": "data:image/png;base64,...",
        "dialogue": ["å°æ˜æœ‰åŠä¸ªè‹¹æœ"],
        "narration": "è¿™æ˜¯åˆ†æ•°çš„å¼€å§‹",
        "order": 1
      }
    ],
    "metadata": {
      "mathConcept": "åˆ†æ•°åŠ æ³•",
      "createdAt": "2024-12-15T10:30:00Z"
    }
  }
}
```

#### è·å–æ¼«ç”»åˆ—è¡¨
```http
GET /api/comic
```

#### ç³»ç»Ÿå¥åº·æ£€æŸ¥
```http
GET /api/comic/health
```

### é”™è¯¯å¤„ç†
æ‰€æœ‰APIå“åº”éƒ½éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š
```json
{
  "success": false,
  "statusCode": 400,
  "error": "Invalid Request",
  "message": "ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯",
  "details": "è¯¦ç»†é”™è¯¯ä¿¡æ¯",
  "timestamp": "2024-12-15T10:30:00Z",
  "requestId": "req-123"
}
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### è¾“å…¥éªŒè¯
- **æ•°å­¦æ¦‚å¿µéªŒè¯**: ç¡®ä¿è¾“å…¥ä¸ºæœ‰æ•ˆæ•°å­¦å†…å®¹
- **å‚æ•°èŒƒå›´æ£€æŸ¥**: éªŒè¯å¹´é¾„ç»„ã€é¢æ¿æ•°é‡ç­‰å‚æ•°
- **å†…å®¹è¿‡æ»¤**: è¿‡æ»¤ä¸å½“å†…å®¹å’Œå…³é”®è¯

### APIå®‰å…¨
- **é€Ÿç‡é™åˆ¶**: é˜²æ­¢APIæ»¥ç”¨
- **CORSé…ç½®**: æ§åˆ¶è·¨åŸŸè®¿é—®
- **å®‰å…¨å¤´**: æ·»åŠ å®‰å…¨ç›¸å…³HTTPå¤´
- **è¾“å…¥æ¸…ç†**: é˜²æ­¢æ³¨å…¥æ”»å‡»

### æ•°æ®å®‰å…¨
- **æœ¬åœ°å­˜å‚¨**: æ•æ„Ÿæ•°æ®ä¸ä¼ è¾“åˆ°å¤–éƒ¨
- **åŠ å¯†ä¼ è¾“**: ä½¿ç”¨HTTPSåŠ å¯†é€šä¿¡
- **è®¿é—®æ§åˆ¶**: å®ç°ç”¨æˆ·æƒé™ç®¡ç†

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—é…ç½®
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "MathComicGenerator": "Debug"
    }
  }
}
```

### æ€§èƒ½ç›‘æ§
```csharp
// è‡ªå®šä¹‰æ€§èƒ½è®¡æ•°å™¨
services.AddSingleton<IMetrics, MetricsService>();

// å¥åº·æ£€æŸ¥
services.AddHealthChecks()
    .AddCheck<GeminiAPIHealthCheck>("gemini-api")
    .AddCheck<StorageHealthCheck>("storage");
```

### é”™è¯¯è¿½è¸ª
```csharp
// å…¨å±€é”™è¯¯å¤„ç†
app.UseMiddleware<GlobalErrorHandlingMiddleware>();

// ç»“æ„åŒ–æ—¥å¿—
_logger.LogError(ex, "Comic generation failed for concept: {Concept}", 
    request.MathConcept);
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 1. ç¯å¢ƒå˜é‡
```bash
export ASPNETCORE_ENVIRONMENT=Production
export GEMINI_API_KEY=your-api-key
export STORAGE_PATH=/app/data
```

#### 2. ç³»ç»ŸæœåŠ¡é…ç½®
```ini
# /etc/systemd/system/mathcomicgenerator.service
[Unit]
Description=Math Comic Generator
After=network.target

[Service]
Type=notify
ExecStart=/usr/bin/dotnet /app/MathComicGenerator.Api.dll
Restart=always
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=mathcomicgenerator
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production

[Install]
WantedBy=multi-user.target
```

#### 3. Nginxåå‘ä»£ç†
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection keep-alive;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### æ•°æ®åº“è¿ç§» (å¦‚éœ€è¦)
```bash
# åˆ›å»ºè¿ç§»
dotnet ef migrations add InitialCreate

# åº”ç”¨è¿ç§»
dotnet ef database update
```

## ğŸ”„ æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²

### GitHub Actionsé…ç½®
```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 8.0.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-build --verbosity normal

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
    - uses: actions/checkout@v3
    - name: Deploy to production
      run: |
        # éƒ¨ç½²è„šæœ¬
        ./deploy.sh
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
```csharp
// å†…å­˜ç¼“å­˜
services.AddMemoryCache();

// åˆ†å¸ƒå¼ç¼“å­˜ (Redis)
services.AddStackExchangeRedisCache(options =>
{
    options.Configuration = "localhost:6379";
});
```

### å¼‚æ­¥å¤„ç†
```csharp
// åå°ä»»åŠ¡é˜Ÿåˆ—
services.AddHostedService<ComicGenerationBackgroundService>();
services.AddSingleton<IBackgroundTaskQueue, BackgroundTaskQueue>();
```

### èµ„æºç®¡ç†
```csharp
// è¿æ¥æ± 
services.AddHttpClient<IGeminiAPIService>()
    .ConfigurePrimaryHttpMessageHandler(() => new HttpClientHandler()
    {
        MaxConnectionsPerServer = 10
    });
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. JavaScriptäº’æ“ä½œé”™è¯¯
**é—®é¢˜**: Blazor Serveré¢„æ¸²æŸ“é˜¶æ®µè°ƒç”¨JavaScriptæ–¹æ³•
```
System.InvalidOperationException: JavaScript interop calls cannot be issued at this time
```

**è§£å†³æ–¹æ¡ˆ**:
```csharp
// å°†JavaScriptè°ƒç”¨ç§»åˆ°OnAfterRenderAsync
protected override async Task OnAfterRenderAsync(bool firstRender)
{
    if (firstRender)
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("someFunction");
        }
        catch (InvalidOperationException)
        {
            // å¿½ç•¥é¢„æ¸²æŸ“é˜¶æ®µçš„é”™è¯¯
        }
    }
}
```

#### 2. APIè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://generativelanguage.googleapis.com

# éªŒè¯APIå¯†é’¥
curl -H "Authorization: Bearer $GEMINI_API_KEY" \
     https://generativelanguage.googleapis.com/v1/models
```

#### 2. å†…å­˜æ³„æ¼
```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
dotnet-counters monitor --process-id <pid> --counters System.Runtime

# ç”Ÿæˆå†…å­˜è½¬å‚¨
dotnet-dump collect --process-id <pid>
```

#### 3. æ€§èƒ½é—®é¢˜
```bash
# æ€§èƒ½åˆ†æ
dotnet-trace collect --process-id <pid> --providers Microsoft-AspNetCore-Server-Kestrel
```

### è°ƒè¯•æŠ€å·§
```csharp
// æ¡ä»¶ç¼–è¯‘
#if DEBUG
    services.AddDeveloperExceptionPage();
#endif

// è¯¦ç»†æ—¥å¿—
services.AddLogging(builder =>
{
    builder.AddConsole();
    builder.AddDebug();
    builder.SetMinimumLevel(LogLevel.Trace);
});
```

## ğŸ“š æ‰©å±•å¼€å‘

### æ·»åŠ æ–°åŠŸèƒ½
1. **åˆ›å»ºæ¥å£**: åœ¨`Shared/Interfaces`ä¸­å®šä¹‰
2. **å®ç°æœåŠ¡**: åœ¨`Shared/Services`ä¸­å®ç°
3. **æ³¨å†ŒæœåŠ¡**: åœ¨`Program.cs`ä¸­æ³¨å†Œ
4. **ç¼–å†™æµ‹è¯•**: åœ¨`Tests`é¡¹ç›®ä¸­æ·»åŠ æµ‹è¯•
5. **æ›´æ–°æ–‡æ¡£**: æ›´æ–°ç›¸å…³æ–‡æ¡£

### è‡ªå®šä¹‰ä¸­é—´ä»¶
```csharp
public class CustomMiddleware
{
    private readonly RequestDelegate _next;

    public CustomMiddleware(RequestDelegate next)
    {
        _next = next;
    }

    public async Task InvokeAsync(HttpContext context)
    {
        // è‡ªå®šä¹‰é€»è¾‘
        await _next(context);
    }
}

// æ³¨å†Œä¸­é—´ä»¶
app.UseMiddleware<CustomMiddleware>();
```

### æ’ä»¶ç³»ç»Ÿ
```csharp
// æ’ä»¶æ¥å£
public interface IComicPlugin
{
    string Name { get; }
    Task<ComicPanel> ProcessPanelAsync(ComicPanel panel);
}

// æ’ä»¶åŠ è½½å™¨
public class PluginLoader
{
    public IEnumerable<IComicPlugin> LoadPlugins(string pluginPath)
    {
        // åŠ¨æ€åŠ è½½æ’ä»¶
    }
}
```

---

## ğŸ“ æ”¯æŒå’Œè´¡çŒ®

### è·å–å¸®åŠ©
- **æ–‡æ¡£**: æŸ¥çœ‹ç”¨æˆ·æ‰‹å†Œå’ŒAPIæ–‡æ¡£
- **Issues**: åœ¨GitHubä¸Šæäº¤é—®é¢˜
- **è®¨è®º**: å‚ä¸ç¤¾åŒºè®¨è®º

### è´¡çŒ®ä»£ç 
1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»ºPull Request
5. ä»£ç å®¡æŸ¥

### å¼€å‘è§„èŒƒ
- **ä»£ç é£æ ¼**: éµå¾ª.NETç¼–ç è§„èŒƒ
- **æäº¤æ¶ˆæ¯**: ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤æ¶ˆæ¯
- **æµ‹è¯•è¦†ç›–**: æ–°åŠŸèƒ½å¿…é¡»åŒ…å«æµ‹è¯•
- **æ–‡æ¡£æ›´æ–°**: æ›´æ–°ç›¸å…³æ–‡æ¡£

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ï¼Œæ¬¢è¿è´¡çŒ®å’Œåé¦ˆï¼*